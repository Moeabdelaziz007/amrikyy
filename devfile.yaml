schemaVersion: 2.2.0
metadata:
  name: auraos-development
  displayName: AuraOS Development Environment
  description: Complete development environment for AuraOS project
  tags:
    - React
    - Node.js
    - Python
    - TypeScript
    - PostgreSQL
    - Redis
  projectType: fullstack
  language: typescript
  version: 1.0.0

# Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø©
variables:
  NODE_VERSION: "18"
  PYTHON_VERSION: "3.11"
  POSTGRES_VERSION: "15"
  REDIS_VERSION: "7"

# Ù…ÙƒÙˆÙ†Ø§Øª Ø¨ÙŠØ¦Ø© Ø§Ù„ØªØ·ÙˆÙŠØ±
components:
  # Node.js Ù„Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ© ÙˆØ§Ù„Ø®Ù„ÙÙŠØ©
  - name: nodejs-dev
    container:
      image: node:18-alpine
      memoryLimit: 2Gi
      cpuLimit: 1000m
      mountSources: true
      sourceMapping: /projects
      env:
        - name: NODE_ENV
          value: development
        - name: PORT
          value: "3000"
        - name: API_PORT
          value: "3001"
      endpoints:
        - name: frontend
          targetPort: 3000
          exposure: public
          protocol: https
        - name: backend
          targetPort: 3001
          exposure: public
          protocol: https
      volumeMounts:
        - name: node-modules
          path: /projects/node_modules

  # Python Ù„Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙˆØ§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
  - name: python-dev
    container:
      image: python:3.11-slim
      memoryLimit: 1Gi
      cpuLimit: 500m
      mountSources: true
      sourceMapping: /projects
      env:
        - name: PYTHONPATH
          value: /projects
        - name: PYTHON_ENV
          value: development
      command: ['tail', '-f', '/dev/null']

  # PostgreSQL Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  - name: postgres-db
    container:
      image: postgres:15-alpine
      memoryLimit: 512Mi
      cpuLimit: 500m
      env:
        - name: POSTGRES_DB
          value: auraos_automation
        - name: POSTGRES_USER
          value: postgres
        - name: POSTGRES_PASSWORD
          value: auraos123
        - name: PGDATA
          value: /var/lib/postgresql/data/pgdata
      endpoints:
        - name: postgres
          targetPort: 5432
          exposure: internal
      volumeMounts:
        - name: postgres-data
          path: /var/lib/postgresql/data

  # Redis Ù„Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª
  - name: redis-cache
    container:
      image: redis:7-alpine
      memoryLimit: 256Mi
      cpuLimit: 250m
      command: ['redis-server', '--appendonly', 'yes']
      endpoints:
        - name: redis
          targetPort: 6379
          exposure: internal
      volumeMounts:
        - name: redis-data
          path: /data

  # Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ·ÙˆÙŠØ±
  - name: dev-tools
    container:
      image: quay.io/devfile/universal-developer-image:ubi8-latest
      memoryLimit: 1Gi
      cpuLimit: 500m
      mountSources: true
      sourceMapping: /projects
      env:
        - name: SHELL
          value: /bin/bash

# Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„ØªØ®Ø²ÙŠÙ†
volumes:
  - name: node-modules
    size: 2Gi
  - name: postgres-data
    size: 1Gi
  - name: redis-data
    size: 512Mi

# Ø£ÙˆØ§Ù…Ø± Ø§Ù„ØªØ·ÙˆÙŠØ±
commands:
  # Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
  - id: install-dependencies
    exec:
      label: "ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª"
      component: nodejs-dev
      workingDir: ${PROJECT_SOURCE}
      commandLine: |
        echo "ğŸš€ ØªØ«Ø¨ÙŠØª Ù…ØªØ·Ù„Ø¨Ø§Øª Node.js..."
        npm install
        echo "âœ… ØªÙ… ØªØ«Ø¨ÙŠØª Ù…ØªØ·Ù„Ø¨Ø§Øª Node.js Ø¨Ù†Ø¬Ø§Ø­"
      group:
        kind: build
        isDefault: true

  - id: install-python-deps
    exec:
      label: "ØªØ«Ø¨ÙŠØª Ù…ØªØ·Ù„Ø¨Ø§Øª Python"
      component: python-dev
      workingDir: ${PROJECT_SOURCE}
      commandLine: |
        echo "ğŸ ØªØ«Ø¨ÙŠØª Ù…ØªØ·Ù„Ø¨Ø§Øª Python..."
        pip install --upgrade pip
        pip install flask fastapi uvicorn requests python-telegram-bot
        echo "âœ… ØªÙ… ØªØ«Ø¨ÙŠØª Ù…ØªØ·Ù„Ø¨Ø§Øª Python Ø¨Ù†Ø¬Ø§Ø­"
      group:
        kind: build

  # ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø§Øª
  - id: start-frontend
    exec:
      label: "ØªØ´ØºÙŠÙ„ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©"
      component: nodejs-dev
      workingDir: ${PROJECT_SOURCE}
      commandLine: |
        echo "ğŸ¨ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©..."
        python -m http.server 3000
      group:
        kind: run

  - id: start-backend
    exec:
      label: "ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ø®Ù„ÙÙŠ"
      component: nodejs-dev
      workingDir: ${PROJECT_SOURCE}
      commandLine: |
        echo "ğŸ”§ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ø®Ù„ÙÙŠ..."
        node server/index.js || echo "ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù„Ù server/index.js"
      group:
        kind: run

  - id: start-python-services
    exec:
      label: "ØªØ´ØºÙŠÙ„ Ø®Ø¯Ù…Ø§Øª Python"
      component: python-dev
      workingDir: ${PROJECT_SOURCE}
      commandLine: |
        echo "ğŸ¤– ØªØ´ØºÙŠÙ„ Ø®Ø¯Ù…Ø§Øª Python..."
        python run_complete_system.py
      group:
        kind: run

  # Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  - id: test-postgres
    exec:
      label: "Ø§Ø®ØªØ¨Ø§Ø± PostgreSQL"
      component: nodejs-dev
      workingDir: ${PROJECT_SOURCE}
      commandLine: |
        echo "ğŸ—„ï¸ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ PostgreSQL..."
        node -e "
        const { Client } = require('pg');
        const client = new Client({
          host: 'localhost',
          port: 5432,
          database: 'auraos_automation',
          user: 'postgres',
          password: 'auraos123'
        });
        client.connect()
          .then(() => console.log('âœ… PostgreSQL Ù…ØªØµÙ„ Ø¨Ù†Ø¬Ø§Ø­'))
          .catch(err => console.log('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„:', err.message))
          .finally(() => client.end());
        "
      group:
        kind: test

  - id: test-redis
    exec:
      label: "Ø§Ø®ØªØ¨Ø§Ø± Redis"
      component: nodejs-dev
      workingDir: ${PROJECT_SOURCE}
      commandLine: |
        echo "ğŸ’¾ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Redis..."
        node -e "
        const redis = require('redis');
        const client = redis.createClient({ host: 'localhost', port: 6379 });
        client.on('connect', () => console.log('âœ… Redis Ù…ØªØµÙ„ Ø¨Ù†Ø¬Ø§Ø­'));
        client.on('error', (err) => console.log('âŒ Ø®Ø·Ø£ ÙÙŠ Redis:', err.message));
        client.connect();
        "
      group:
        kind: test

  # Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ·ÙˆÙŠØ±
  - id: format-code
    exec:
      label: "ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙƒÙˆØ¯"
      component: nodejs-dev
      workingDir: ${PROJECT_SOURCE}
      commandLine: |
        echo "ğŸ¨ ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙƒÙˆØ¯..."
        npx prettier --write "**/*.{js,ts,tsx,css,html,json}"
        echo "âœ… ØªÙ… ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­"
      group:
        kind: build

  - id: lint-code
    exec:
      label: "ÙØ­Øµ Ø¬ÙˆØ¯Ø© Ø§Ù„ÙƒÙˆØ¯"
      component: nodejs-dev
      workingDir: ${PROJECT_SOURCE}
      commandLine: |
        echo "ğŸ” ÙØ­Øµ Ø¬ÙˆØ¯Ø© Ø§Ù„ÙƒÙˆØ¯..."
        npx eslint . --ext .js,.ts,.tsx || echo "ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ESLint"
        echo "âœ… ØªÙ… ÙØ­Øµ Ø§Ù„ÙƒÙˆØ¯"
      group:
        kind: test

  # ØªØ´ØºÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ù„Ù†Ø¸Ø§Ù…
  - id: start-all
    composite:
      label: "ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… ÙƒØ§Ù…Ù„Ø§Ù‹"
      commands:
        - install-dependencies
        - install-python-deps
        - start-frontend
        - start-backend
        - start-python-services
      group:
        kind: run
        isDefault: true

# Ø£Ø­Ø¯Ø§Ø« Ø¯ÙˆØ±Ø© Ø§Ù„Ø­ÙŠØ§Ø©
events:
  # Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø³Ø§Ø­Ø©
  preStart:
    - install-dependencies
    - install-python-deps
  
  # Ø¹Ù†Ø¯ Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù
  postStop:
    - format-code

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
starterProjects:
  - name: auraos-starter
    description: AuraOS Project Template
    git:
      remotes:
        origin: https://github.com/yourusername/auraos.git
